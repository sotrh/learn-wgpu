<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dependencies and the window | Learn Wgpu</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/learn-wgpu/assets/css/0.styles.81cb5453.css" as="style"><link rel="preload" href="/learn-wgpu/assets/js/app.bb5aa293.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/3.f1fc01f9.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/2.0825fb6a.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/55.880ae009.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/20.e8d2d7ca.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/37.073c9bdc.js" as="script"><link rel="prefetch" href="/learn-wgpu/assets/js/1.bb61355d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/10.ec544d7a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/11.aec6abdf.js"><link rel="prefetch" href="/learn-wgpu/assets/js/12.648436b0.js"><link rel="prefetch" href="/learn-wgpu/assets/js/13.e80e5a0c.js"><link rel="prefetch" href="/learn-wgpu/assets/js/14.43e29875.js"><link rel="prefetch" href="/learn-wgpu/assets/js/15.1711bea8.js"><link rel="prefetch" href="/learn-wgpu/assets/js/16.50f80160.js"><link rel="prefetch" href="/learn-wgpu/assets/js/17.f76be9b8.js"><link rel="prefetch" href="/learn-wgpu/assets/js/18.ecc31375.js"><link rel="prefetch" href="/learn-wgpu/assets/js/19.8772d7e6.js"><link rel="prefetch" href="/learn-wgpu/assets/js/21.5f74e206.js"><link rel="prefetch" href="/learn-wgpu/assets/js/22.22b8c06b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/23.9915ee08.js"><link rel="prefetch" href="/learn-wgpu/assets/js/24.4eaf259c.js"><link rel="prefetch" href="/learn-wgpu/assets/js/25.c061a64a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/26.9adb2d27.js"><link rel="prefetch" href="/learn-wgpu/assets/js/27.5387040b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/28.469ca8ee.js"><link rel="prefetch" href="/learn-wgpu/assets/js/29.6d1c48a8.js"><link rel="prefetch" href="/learn-wgpu/assets/js/30.a463b9c6.js"><link rel="prefetch" href="/learn-wgpu/assets/js/31.a2a208d4.js"><link rel="prefetch" href="/learn-wgpu/assets/js/32.ae9d7f51.js"><link rel="prefetch" href="/learn-wgpu/assets/js/33.00cc99f5.js"><link rel="prefetch" href="/learn-wgpu/assets/js/34.85615e37.js"><link rel="prefetch" href="/learn-wgpu/assets/js/35.a3b47c6d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/36.177e4ad6.js"><link rel="prefetch" href="/learn-wgpu/assets/js/38.1e9969b8.js"><link rel="prefetch" href="/learn-wgpu/assets/js/39.b3de3a3f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/4.5f74298f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/40.37536a0b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/41.18623d21.js"><link rel="prefetch" href="/learn-wgpu/assets/js/42.e84d3991.js"><link rel="prefetch" href="/learn-wgpu/assets/js/43.98f892b9.js"><link rel="prefetch" href="/learn-wgpu/assets/js/44.5d75e802.js"><link rel="prefetch" href="/learn-wgpu/assets/js/45.2404e9ee.js"><link rel="prefetch" href="/learn-wgpu/assets/js/46.da2b9445.js"><link rel="prefetch" href="/learn-wgpu/assets/js/47.acb47069.js"><link rel="prefetch" href="/learn-wgpu/assets/js/48.01428997.js"><link rel="prefetch" href="/learn-wgpu/assets/js/49.d54cf50a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/5.c1fd28fa.js"><link rel="prefetch" href="/learn-wgpu/assets/js/50.b875001a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/51.d602cfe2.js"><link rel="prefetch" href="/learn-wgpu/assets/js/52.25a801aa.js"><link rel="prefetch" href="/learn-wgpu/assets/js/53.e1c14889.js"><link rel="prefetch" href="/learn-wgpu/assets/js/54.bea932b4.js"><link rel="prefetch" href="/learn-wgpu/assets/js/56.e4e1b06a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/57.2feda4bc.js"><link rel="prefetch" href="/learn-wgpu/assets/js/58.a632308f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/59.e50ba2ab.js"><link rel="prefetch" href="/learn-wgpu/assets/js/6.d3f3ec42.js"><link rel="prefetch" href="/learn-wgpu/assets/js/60.d2e0243d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/61.20ac3a12.js"><link rel="prefetch" href="/learn-wgpu/assets/js/62.010fa568.js"><link rel="prefetch" href="/learn-wgpu/assets/js/63.1f4f7ab3.js"><link rel="prefetch" href="/learn-wgpu/assets/js/64.0bc140da.js"><link rel="prefetch" href="/learn-wgpu/assets/js/65.7b70084b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/66.9e587ec8.js"><link rel="prefetch" href="/learn-wgpu/assets/js/67.96a7ae86.js"><link rel="prefetch" href="/learn-wgpu/assets/js/68.8adb027d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/69.54455d89.js"><link rel="prefetch" href="/learn-wgpu/assets/js/70.5991d1d3.js"><link rel="prefetch" href="/learn-wgpu/assets/js/71.bfd4a345.js"><link rel="prefetch" href="/learn-wgpu/assets/js/72.61c7e128.js"><link rel="prefetch" href="/learn-wgpu/assets/js/9.2b36e89e.js"><link rel="prefetch" href="/learn-wgpu/assets/js/vendors~docsearch.36ab8bc3.js">
    <link rel="stylesheet" href="/learn-wgpu/assets/css/0.styles.81cb5453.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu/" class="home-link router-link-active"><!----> <span class="site-name">Learn Wgpu</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu/" aria-current="page" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Beginner</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/beginner/tutorial1-window/" aria-current="page" class="active sidebar-link">Dependencies and the window</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#boring-i-know" class="sidebar-link">Boring, I know</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#what-crates-are-we-using" class="sidebar-link">What crates are we using?</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#using-rust-s-new-resolver" class="sidebar-link">Using Rust's new resolver</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#env-logger" class="sidebar-link">env_logger</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#create-a-new-project" class="sidebar-link">Create a new project</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#the-code" class="sidebar-link">The code</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#added-support-for-the-web" class="sidebar-link">Added support for the web</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#web-assembly" class="sidebar-link">Web Assembly</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#more-code" class="sidebar-link">More code</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#wasm-pack" class="sidebar-link">Wasm Pack</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/beginner/tutorial1-window/#demo" class="sidebar-link">Demo</a></li></ul></li><li><a href="/learn-wgpu/beginner/tutorial2-surface/" class="sidebar-link">The Surface</a></li><li><a href="/learn-wgpu/beginner/tutorial3-pipeline/" class="sidebar-link">The Pipeline</a></li><li><a href="/learn-wgpu/beginner/tutorial4-buffer/" class="sidebar-link">Buffers and Indices</a></li><li><a href="/learn-wgpu/beginner/tutorial5-textures/" class="sidebar-link">Textures and bind groups</a></li><li><a href="/learn-wgpu/beginner/tutorial6-uniforms/" class="sidebar-link">Uniform buffers and a 3d camera</a></li><li><a href="/learn-wgpu/beginner/tutorial7-instancing/" class="sidebar-link">Instancing</a></li><li><a href="/learn-wgpu/beginner/tutorial8-depth/" class="sidebar-link">The Depth Buffer</a></li><li><a href="/learn-wgpu/beginner/tutorial9-models/" class="sidebar-link">Model Loading</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Intermediate</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/intermediate/tutorial10-lighting/" class="sidebar-link">Working with Lights</a></li><li><a href="/learn-wgpu/intermediate/tutorial11-normals/" class="sidebar-link">Normal Mapping</a></li><li><a href="/learn-wgpu/intermediate/tutorial12-camera/" class="sidebar-link">A Better Camera</a></li><li><a href="/learn-wgpu/intermediate/tutorial13-hdr/" class="sidebar-link">High Dynamic Range Rendering</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Showcase</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>News</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="dependencies-and-the-window"><a href="#dependencies-and-the-window" class="header-anchor">#</a> Dependencies and the window</h1> <h2 id="boring-i-know"><a href="#boring-i-know" class="header-anchor">#</a> Boring, I know</h2> <p>Some of you reading this are very experienced with opening up windows in Rust and probably have your favorite windowing library, but this guide is designed for everybody, so it's something that we need to cover. Luckily, you don't need to read this if you know what you're doing. One thing that you do need to know is that whatever windowing solution you use needs to support the <a href="https://github.com/rust-windowing/raw-window-handle" target="_blank" rel="noopener noreferrer">raw-window-handle<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> crate.</p> <h2 id="what-crates-are-we-using"><a href="#what-crates-are-we-using" class="header-anchor">#</a> What crates are we using?</h2> <p>For the beginner stuff, we're going to keep things very simple. We'll add things as we go, but I've listed the relevant <code>Cargo.toml</code> bits below.</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">winit</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.30&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;android-native-activity&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">env_logger</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.10&quot;</span>
<span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.4&quot;</span>
<span class="token key property">wgpu</span> <span class="token punctuation">=</span> <span class="token string">&quot;25.0&quot;</span>
</code></pre></div><h2 id="using-rust-s-new-resolver"><a href="#using-rust-s-new-resolver" class="header-anchor">#</a> Using Rust's new resolver</h2> <p>As of version 0.10, wgpu requires Cargo's <a href="https://doc.rust-lang.org/cargo/reference/resolver.html#feature-resolver-version-2" target="_blank" rel="noopener noreferrer">newest feature resolver<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which is the default in the 2021 edition (any new project started with Rust version 1.56.0 or newer). However, if you are still using the 2018 edition, you must include <code>resolver = &quot;2&quot;</code> in either the <code>[package]</code> section of <code>Cargo.toml</code> if you are working on a single crate or the <code>[workspace]</code> section of the root <code>Cargo.toml</code> in a workspace.</p> <h2 id="env-logger"><a href="#env-logger" class="header-anchor">#</a> env_logger</h2> <p>It is very important to enable logging via <code>env_logger::init();</code>.
When wgpu hits any error, it panics with a generic message, while logging the real error via the log crate.
This means if you don't include <code>env_logger::init()</code>, wgpu will fail silently, leaving you very confused!<br>
(This has been done in the code below)</p> <h2 id="create-a-new-project"><a href="#create-a-new-project" class="header-anchor">#</a> Create a new project</h2> <p>run <code>cargo new project_name</code> where project_name is the name of the project.<br>
(In the example below, I have used 'tutorial1_window')</p> <h2 id="the-code"><a href="#the-code" class="header-anchor">#</a> The code</h2> <p>We are going to want somewhere to put all of our state so let's create a <code>State</code> struct.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Arc</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">winit<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token namespace">application<span class="token punctuation">::</span></span><span class="token class-name">ApplicationHandler</span><span class="token punctuation">,</span> <span class="token namespace">event<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token namespace">event_loop<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">ActiveEventLoop</span><span class="token punctuation">,</span> <span class="token class-name">EventLoop</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token namespace">keyboard<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">KeyCode</span><span class="token punctuation">,</span> <span class="token class-name">PhysicalKey</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token namespace">window<span class="token punctuation">::</span></span><span class="token class-name">Window</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
<span class="token keyword">use</span> <span class="token namespace">wasm_bindgen<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token comment">// This will store the state of our game</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">State</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Window</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    <span class="token comment">// We don't need this to be async right now,</span>
    <span class="token comment">// but we will in the next tutorial</span>
    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">:</span> <span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">Window</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">Self</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">resize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> _width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> _height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// We'll do stuff here in the next tutorial</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">render</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">request_redraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// We'll do more stuff here in the next tutorial</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
</code></pre></div><p>There's not much going on here, but once we start using WGPU will start filling this up pretty quick. Most of the methods on this struct are place holders, though in <code>render()</code> we ask the window to draw another frame as soon as possible as winit only draws one frame unless the window is resized or we request it to draw another one.</p> <p>Now that we have our <code>State</code> struct, we need to tell winit how to use it. We'll create an <code>App</code> struct for this.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">App</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
    proxy<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token namespace">winit<span class="token punctuation">::</span>event_loop<span class="token punctuation">::</span></span><span class="token class-name">EventLoopProxy</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
    state<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span> event_loop<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">EventLoop</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
        <span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>event_loop<span class="token punctuation">.</span><span class="token function">create_proxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            state<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
            <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
            proxy<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>So the <code>App</code> struct has two fields: <code>state</code> and <code>proxy</code>.</p> <p>The <code>state</code> variable stores our <code>State</code> struct as an option.The reason we need an option is that <code>State::new()</code> needs a window and we can't create a window until the application gets to the <code>Resumed</code> state. We'll get more into that in a bit.</p> <p>The <code>proxy</code> variable is only needed on the web. The reason for this is that creating WGPU resources is an async process. Again we'll get into that in a bit.</p> <p>Now that we have an <code>App</code> struct we need to implement the <code>ApplicationHandler</code> trait. This will give us a variety of different functions that we can use to get application events such as key press, mouse movements and various lifecycle events. We'll start by covering the <code>resumed</code> and <code>user_event</code> methods first.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">ApplicationHandler</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">resumed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> event_loop<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">ActiveEventLoop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token attribute attr-name">#[allow(unused_mut)]</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> window_attributes <span class="token operator">=</span> <span class="token class-name">Window</span><span class="token punctuation">::</span><span class="token function">default_attributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">use</span> <span class="token namespace">wasm_bindgen<span class="token punctuation">::</span></span><span class="token class-name">JsCast</span><span class="token punctuation">;</span>
            <span class="token keyword">use</span> <span class="token namespace">winit<span class="token punctuation">::</span>platform<span class="token punctuation">::</span>web<span class="token punctuation">::</span></span><span class="token class-name">WindowAttributesExtWebSys</span><span class="token punctuation">;</span>
            
            <span class="token keyword">const</span> <span class="token constant">CANVAS_ID</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;canvas&quot;</span><span class="token punctuation">;</span>

            <span class="token keyword">let</span> window <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span>web_sys<span class="token punctuation">::</span></span><span class="token function">window</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> document <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">get_element_by_id</span><span class="token punctuation">(</span><span class="token constant">CANVAS_ID</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> html_canvas_element <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">unchecked_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            window_attributes <span class="token operator">=</span> window_attributes<span class="token punctuation">.</span><span class="token function">with_canvas</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>html_canvas_element<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> window <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>event_loop<span class="token punctuation">.</span><span class="token function">create_window</span><span class="token punctuation">(</span>window_attributes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token attribute attr-name">#[cfg(not(target_arch = <span class="token string">&quot;wasm32&quot;</span>))]</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// If we are not on web we can use pollster to</span>
            <span class="token comment">// await the </span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">pollster<span class="token punctuation">::</span></span><span class="token function">block_on</span><span class="token punctuation">(</span><span class="token class-name">State</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Run the future asynchronously and use the</span>
            <span class="token comment">// proxy to send the results to the event loop</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>proxy<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>proxy<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token namespace">wasm_bindgen_futures<span class="token punctuation">::</span></span><span class="token function">spawn_local</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
                    <span class="token macro property">assert!</span><span class="token punctuation">(</span>proxy
                        <span class="token punctuation">.</span><span class="token function">send_event</span><span class="token punctuation">(</span>
                            <span class="token class-name">State</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token keyword">await</span>
                                <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to create canvas!!!&quot;</span><span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[allow(unused_mut)]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">user_event</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> _event_loop<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">ActiveEventLoop</span><span class="token punctuation">,</span> <span class="token keyword">mut</span> event<span class="token punctuation">:</span> <span class="token class-name">State</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// This is where proxy.send_event() ends up</span>
        <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
        <span class="token punctuation">{</span>
            event<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">request_redraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            event<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>
                event<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">inner_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>
                event<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">inner_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>resumed</code> method seems like it does a lot, but it only does a few things:</p> <ul><li>It defines attributes about the window including some web specific stuff.</li> <li>We use those attributes to create the window.</li> <li>We create a future that creates our <code>State</code> struct</li> <li>On native we use pollster to get await the future</li> <li>On web we run the future asynchronously which sends the results to the <code>user_event</code> function</li></ul> <p>The <code>user_event</code> function just serves as a landing point for our <code>State</code> future. <code>resumed</code> isn't async so we need to offload the future and send the results somewhere.</p> <p>Next we'll talk about <code>window_event</code>.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">ApplicationHandler</span><span class="token operator">&lt;</span><span class="token class-name">State</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>

    <span class="token comment">// ...</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">window_event</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span>
        event_loop<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">ActiveEventLoop</span><span class="token punctuation">,</span>
        _window_id<span class="token punctuation">:</span> <span class="token namespace">winit<span class="token punctuation">::</span>window<span class="token punctuation">::</span></span><span class="token class-name">WindowId</span><span class="token punctuation">,</span>
        event<span class="token punctuation">:</span> <span class="token class-name">WindowEvent</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token keyword">match</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>state <span class="token punctuation">{</span>
            <span class="token class-name">Some</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> canvas<span class="token punctuation">,</span>
            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">match</span> event <span class="token punctuation">{</span>
            <span class="token class-name">WindowEvent</span><span class="token punctuation">::</span><span class="token class-name">CloseRequested</span> <span class="token operator">=&gt;</span> event_loop<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">WindowEvent</span><span class="token punctuation">::</span><span class="token class-name">Resized</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> size<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">WindowEvent</span><span class="token punctuation">::</span><span class="token class-name">RedrawRequested</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                state<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">WindowEvent</span><span class="token punctuation">::</span><span class="token class-name">KeyboardInput</span> <span class="token punctuation">{</span>
                event<span class="token punctuation">:</span>
                    <span class="token class-name">KeyEvent</span> <span class="token punctuation">{</span>
                        physical_key<span class="token punctuation">:</span> <span class="token class-name">PhysicalKey</span><span class="token punctuation">::</span><span class="token class-name">Code</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        state<span class="token punctuation">,</span>
                        <span class="token punctuation">..</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">..</span>
            <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token keyword">match</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> state<span class="token punctuation">.</span><span class="token function">is_pressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token punctuation">(</span><span class="token class-name">KeyCode</span><span class="token punctuation">::</span><span class="token class-name">Escape</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> event_loop<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            _ <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is where we can process events such as keyboard inputs, and mouse movements, as well as other window events such as when the window wants to draw or is resized. We can call the methods we defined on <code>State</code> here.</p> <p>Next we need to actually run our code. We'll create a <code>run()</code> function to do that.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[cfg(not(target_arch = <span class="token string">&quot;wasm32&quot;</span>))]</span>
    <span class="token punctuation">{</span>
        <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
    <span class="token punctuation">{</span>
        <span class="token namespace">console_log<span class="token punctuation">::</span></span><span class="token function">init_with_level</span><span class="token punctuation">(</span><span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">Level</span><span class="token punctuation">::</span><span class="token class-name">Info</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> event_loop <span class="token operator">=</span> <span class="token class-name">EventLoop</span><span class="token punctuation">::</span><span class="token function">with_user_event</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> app <span class="token operator">=</span> <span class="token class-name">App</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>
        <span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
        <span class="token operator">&amp;</span>event_loop<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    event_loop<span class="token punctuation">.</span><span class="token function">run_app</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> app<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This function sets up the logger as well as creates the <code>event_loop</code> and our <code>app</code> and then runs our <code>app</code> to completion.</p> <h2 id="added-support-for-the-web"><a href="#added-support-for-the-web" class="header-anchor">#</a> Added support for the web</h2> <p>In order to get our app to run on the web we need to make some changes to our <code>Cargo.toml</code>:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">lib</span><span class="token punctuation">]</span>
<span class="token key property">crate-type</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cdylib&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rlib&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>These lines tell Cargo that we want to allow our crate to build a native Rust static library (rlib) and a C/C++ compatible library (cdylib). We need rlib if we want to run wgpu in a desktop environment. We need cdylib to create the Web Assembly that the browser will run.</p> <div class="note"><h2 id="web-assembly"><a href="#web-assembly" class="header-anchor">#</a> Web Assembly</h2> <p>Web Assembly, i.e. WASM, is a binary format supported by most modern browsers that allows lower-level languages such as Rust to run on a web page. This allows us to write the bulk of our application in Rust and use a few lines of Javascript to get it running in a web browser.</p></div> <p>Now, all we need are some more dependencies that are specific to running in WASM:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token comment"># This should go in the Cargo.toml in the root directory</span>
<span class="token punctuation">[</span><span class="token table class-name">profile.release</span><span class="token punctuation">]</span>
<span class="token key property">strip</span> <span class="token punctuation">=</span> <span class="token boolean">true</span>

<span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token comment"># the other regular dependencies...</span>

<span class="token punctuation">[</span><span class="token table class-name">target.'cfg(target_arch = &quot;wasm32&quot;)'.dependencies</span><span class="token punctuation">]</span>
<span class="token key property">console_error_panic_hook</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.1.6&quot;</span>
<span class="token key property">console_log</span> <span class="token punctuation">=</span> <span class="token string">&quot;1.0&quot;</span>
<span class="token key property">wgpu</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;25.0&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;webgl&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token key property">wasm-bindgen</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.2&quot;</span>
<span class="token key property">wasm-bindgen-futures</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.4.30&quot;</span>
<span class="token key property">web-sys</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.3&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;Document&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Window&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;Element&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre></div><p>The <code>[target.'cfg(target_arch = &quot;wasm32&quot;)'.dependencies]</code> line tells Cargo to only include these dependencies if we are targeting the <code>wasm32</code> architecture. The next few dependencies just make interfacing with JavaScript a lot easier.</p> <ul><li><a href="https://docs.rs/console_error_panic_hook" target="_blank" rel="noopener noreferrer">console_error_panic_hook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> configures the <code>panic!</code> macro to send errors to the javascript console. Without this, when you encounter panics, you'll be left in the dark about what caused them.</li> <li><a href="https://docs.rs/console_log" target="_blank" rel="noopener noreferrer">console_log<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> implements the <a href="https://docs.rs/log" target="_blank" rel="noopener noreferrer">log<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> API. It sends all logs to the javascript console. It can be configured to only send logs of a particular log level. This is also great for debugging.</li> <li>We need to enable the WebGL feature on wgpu if we want to run on most current browsers. Support is in the works for using the WebGPU api directly, but that is only possible on experimental versions of browsers such as Firefox Nightly and Chrome Canary.<br>
You're welcome to test this code on these browsers (and the wgpu devs would appreciate it as well), but for the sake of simplicity, I'm going to stick to using the WebGL feature until the WebGPU api gets to a more stable state.<br>
If you want more details, check out the guide for compiling for the web on <a href="https://github.com/gfx-rs/wgpu/wiki/Running-on-the-Web-with-WebGPU-and-WebGL" target="_blank" rel="noopener noreferrer">wgpu's repo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.rs/wasm-bindgen" target="_blank" rel="noopener noreferrer">wasm-bindgen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is the most important dependency in this list. It's responsible for generating the boilerplate code that will tell the browser how to use our crate. It also allows us to expose methods in Rust that can be used in JavaScript and vice-versa.<br>
I won't get into the specifics of wasm-bindgen, so if you need a primer (or just a refresher), check out <a href="https://rustwasm.github.io/wasm-bindgen/" target="_blank" rel="noopener noreferrer">this<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://docs.rs/web-sys" target="_blank" rel="noopener noreferrer">web-sys<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is a crate with many methods and structures available in a normal javascript application: <code>get_element_by_id</code>, <code>append_child</code>. The features listed are only the bare minimum of what we need currently.</li></ul> <h2 id="more-code"><a href="#more-code" class="header-anchor">#</a> More code</h2> <p>Let's create a function to run our code on web.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(target_arch = <span class="token string">&quot;wasm32&quot;</span>)]</span>
<span class="token attribute attr-name">#[wasm_bindgen(start)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run_web</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">wasm_bindgen<span class="token punctuation">::</span></span><span class="token class-name">JsValue</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token namespace">console_error_panic_hook<span class="token punctuation">::</span></span><span class="token function">set_once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_throw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This will set up <code>console_error_panic_hook</code> so that when our code panics we'll see it in the browser console. It will also call the other <code>run()</code> function.</p> <h2 id="wasm-pack"><a href="#wasm-pack" class="header-anchor">#</a> Wasm Pack</h2> <p>Now you can build a wgpu application with just wasm-bindgen, but I ran into some issues doing that. For one, you need to install wasm-bindgen on your computer as well as include it as a dependency. The version you install as a dependency <strong>needs</strong> to exactly match the version you installed. Otherwise, your build will fail.</p> <p>To get around this shortcoming and to make the lives of everyone reading this easier, I opted to add <a href="https://rustwasm.github.io/docs/wasm-pack/" target="_blank" rel="noopener noreferrer">wasm-pack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to the mix. Wasm-pack handles installing the correct version of wasm-bindgen for you, and it supports building for different types of web targets as well: browser, NodeJS, and bundlers such as webpack.</p> <p>To use wasm-pack, first, you need to <a href="https://rustwasm.github.io/wasm-pack/installer/" target="_blank" rel="noopener noreferrer">install it<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Once you've done that, we can use it to build our crate. If you only have one crate in your project, you can just use <code>wasm-pack build</code>. If you're using a workspace, you'll have to specify what crate you want to build. Imagine your crate is a directory called <code>game</code>. You would then use:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>wasm-pack build game
</code></pre></div><p>Once wasm-pack is done building, you'll have a <code>pkg</code> directory in the same directory as your crate. This has all the javascript code needed to run the WASM code. You'd then import the WASM module in javascript:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./pkg/game.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;WASM Loaded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This site uses <a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer">Vuepress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, so I load the WASM in a Vue component. How you handle your WASM will depend on what you want to do. If you want to check out how I'm doing things, take a look at <a href="https://github.com/sotrh/learn-wgpu/blob/master/docs/.vuepress/components/WasmExample.vue" target="_blank" rel="noopener noreferrer">this<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="note"><p>If you intend to use your WASM module in a plain HTML website, you'll need to tell wasm-pack to target the web:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>wasm-pack build <span class="token parameter variable">--target</span> web
</code></pre></div><p>You'll then need to run the WASM code in an ES6 Module:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Learn WGPU<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">canvas</span> <span class="token punctuation">{</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wasm-example<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">import</span> init <span class="token keyword">from</span> <span class="token string">&quot;./pkg/pong.js&quot;</span><span class="token punctuation">;</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;WASM Loaded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <h2 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h2> <p>Press the button below, and you will see the code running!</p> <div id="wasm-example"><canvas id="canvas"></canvas> <!----> <button>Click to start Tutorial1_window!</button></div> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/beginner/tutorial1-window/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/6/2025, 9:02:14 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu/" class="prev router-link-active">
          Introduction
        </a></span> <span class="next"><a href="/learn-wgpu/beginner/tutorial2-surface/">
          The Surface
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu/assets/js/app.bb5aa293.js" defer></script><script src="/learn-wgpu/assets/js/3.f1fc01f9.js" defer></script><script src="/learn-wgpu/assets/js/2.0825fb6a.js" defer></script><script src="/learn-wgpu/assets/js/55.880ae009.js" defer></script><script src="/learn-wgpu/assets/js/20.e8d2d7ca.js" defer></script><script src="/learn-wgpu/assets/js/37.073c9bdc.js" defer></script>
  </body>
</html>
