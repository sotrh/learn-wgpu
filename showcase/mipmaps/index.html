<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mipmapping | Learn Wgpu</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/learn-wgpu/assets/css/0.styles.5ee25272.css" as="style"><link rel="preload" href="/learn-wgpu/assets/js/app.9a4a1a92.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/3.09b12233.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/2.b4dddcef.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/15.51116715.js" as="script"><link rel="preload" href="/learn-wgpu/assets/js/39.f2a3e671.js" as="script"><link rel="prefetch" href="/learn-wgpu/assets/js/1.3558807b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/10.6c8c503b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/11.7d5157d3.js"><link rel="prefetch" href="/learn-wgpu/assets/js/12.c7a7639b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/13.0ff211c0.js"><link rel="prefetch" href="/learn-wgpu/assets/js/14.9642a599.js"><link rel="prefetch" href="/learn-wgpu/assets/js/16.3e9d9b6a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/17.6ca634b1.js"><link rel="prefetch" href="/learn-wgpu/assets/js/18.672c5b5d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/19.6c77f371.js"><link rel="prefetch" href="/learn-wgpu/assets/js/20.684ce7f1.js"><link rel="prefetch" href="/learn-wgpu/assets/js/21.5f6cd02b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/22.83f1c0c1.js"><link rel="prefetch" href="/learn-wgpu/assets/js/23.2fee3e37.js"><link rel="prefetch" href="/learn-wgpu/assets/js/24.67b4ccc5.js"><link rel="prefetch" href="/learn-wgpu/assets/js/25.b2a2c7ec.js"><link rel="prefetch" href="/learn-wgpu/assets/js/26.f6d04d49.js"><link rel="prefetch" href="/learn-wgpu/assets/js/27.4ea91a9a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/28.73721aa4.js"><link rel="prefetch" href="/learn-wgpu/assets/js/29.394fe4be.js"><link rel="prefetch" href="/learn-wgpu/assets/js/30.7049dcd5.js"><link rel="prefetch" href="/learn-wgpu/assets/js/31.5b1fe4b4.js"><link rel="prefetch" href="/learn-wgpu/assets/js/32.f25ea1b1.js"><link rel="prefetch" href="/learn-wgpu/assets/js/33.b8081be0.js"><link rel="prefetch" href="/learn-wgpu/assets/js/34.e12e647a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/35.4a44c032.js"><link rel="prefetch" href="/learn-wgpu/assets/js/36.8dba74db.js"><link rel="prefetch" href="/learn-wgpu/assets/js/37.f9aa3b5e.js"><link rel="prefetch" href="/learn-wgpu/assets/js/38.2c99093b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/4.a61b351a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/40.a367c5f3.js"><link rel="prefetch" href="/learn-wgpu/assets/js/41.412b049e.js"><link rel="prefetch" href="/learn-wgpu/assets/js/42.f357fe57.js"><link rel="prefetch" href="/learn-wgpu/assets/js/43.b38b7739.js"><link rel="prefetch" href="/learn-wgpu/assets/js/44.aaea4c1c.js"><link rel="prefetch" href="/learn-wgpu/assets/js/45.1e7498eb.js"><link rel="prefetch" href="/learn-wgpu/assets/js/46.6114d33c.js"><link rel="prefetch" href="/learn-wgpu/assets/js/47.1917e7f6.js"><link rel="prefetch" href="/learn-wgpu/assets/js/48.156c0523.js"><link rel="prefetch" href="/learn-wgpu/assets/js/49.07fe607e.js"><link rel="prefetch" href="/learn-wgpu/assets/js/5.19ad0b17.js"><link rel="prefetch" href="/learn-wgpu/assets/js/50.a60afeb2.js"><link rel="prefetch" href="/learn-wgpu/assets/js/51.c0dfac19.js"><link rel="prefetch" href="/learn-wgpu/assets/js/52.f4eabe60.js"><link rel="prefetch" href="/learn-wgpu/assets/js/53.9f655aa8.js"><link rel="prefetch" href="/learn-wgpu/assets/js/54.0cda9847.js"><link rel="prefetch" href="/learn-wgpu/assets/js/55.6ab1edd5.js"><link rel="prefetch" href="/learn-wgpu/assets/js/56.4b35e9a5.js"><link rel="prefetch" href="/learn-wgpu/assets/js/57.075c5fd3.js"><link rel="prefetch" href="/learn-wgpu/assets/js/58.5afd0458.js"><link rel="prefetch" href="/learn-wgpu/assets/js/59.e7dc9841.js"><link rel="prefetch" href="/learn-wgpu/assets/js/6.d179b982.js"><link rel="prefetch" href="/learn-wgpu/assets/js/60.2fffa65d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/61.2554209c.js"><link rel="prefetch" href="/learn-wgpu/assets/js/62.a6db7c6b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/63.2d962976.js"><link rel="prefetch" href="/learn-wgpu/assets/js/64.1145b7aa.js"><link rel="prefetch" href="/learn-wgpu/assets/js/65.b87d6054.js"><link rel="prefetch" href="/learn-wgpu/assets/js/66.d959165d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/67.a7f2aa0d.js"><link rel="prefetch" href="/learn-wgpu/assets/js/68.e2e7e4a1.js"><link rel="prefetch" href="/learn-wgpu/assets/js/69.9a9d764c.js"><link rel="prefetch" href="/learn-wgpu/assets/js/70.1ed92f63.js"><link rel="prefetch" href="/learn-wgpu/assets/js/71.c41dfa6b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/72.1d5552c3.js"><link rel="prefetch" href="/learn-wgpu/assets/js/73.b8cd0f6f.js"><link rel="prefetch" href="/learn-wgpu/assets/js/74.69214846.js"><link rel="prefetch" href="/learn-wgpu/assets/js/75.29d78a6a.js"><link rel="prefetch" href="/learn-wgpu/assets/js/76.9016232b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/77.8c3adad6.js"><link rel="prefetch" href="/learn-wgpu/assets/js/78.f833163e.js"><link rel="prefetch" href="/learn-wgpu/assets/js/79.0210a74b.js"><link rel="prefetch" href="/learn-wgpu/assets/js/80.7e9523bf.js"><link rel="prefetch" href="/learn-wgpu/assets/js/9.36fe1add.js"><link rel="prefetch" href="/learn-wgpu/assets/js/vendors~docsearch.d6596893.js">
    <link rel="stylesheet" href="/learn-wgpu/assets/css/0.styles.5ee25272.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu/" class="home-link router-link-active"><!----> <span class="site-name">Learn Wgpu</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu/" aria-current="page" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Beginner</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/beginner/tutorial1-window/" class="sidebar-link">Dependencies and the window</a></li><li><a href="/learn-wgpu/beginner/tutorial2-surface/" class="sidebar-link">The Surface</a></li><li><a href="/learn-wgpu/beginner/tutorial3-pipeline/" class="sidebar-link">The Pipeline</a></li><li><a href="/learn-wgpu/beginner/tutorial4-buffer/" class="sidebar-link">Buffers and Indices</a></li><li><a href="/learn-wgpu/beginner/tutorial5-textures/" class="sidebar-link">Textures and bind groups</a></li><li><a href="/learn-wgpu/beginner/tutorial6-uniforms/" class="sidebar-link">Uniform buffers and a 3d camera</a></li><li><a href="/learn-wgpu/beginner/tutorial7-instancing/" class="sidebar-link">Instancing</a></li><li><a href="/learn-wgpu/beginner/tutorial8-depth/" class="sidebar-link">The Depth Buffer</a></li><li><a href="/learn-wgpu/beginner/tutorial9-models/" class="sidebar-link">Model Loading</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Intermediate</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/intermediate/tutorial10-lighting/" class="sidebar-link">Working with Lights</a></li><li><a href="/learn-wgpu/intermediate/tutorial11-normals/" class="sidebar-link">Normal Mapping</a></li><li><a href="/learn-wgpu/intermediate/tutorial12-camera/" class="sidebar-link">A Better Camera</a></li><li><a href="/learn-wgpu/intermediate/tutorial13-hdr/" class="sidebar-link">High Dynamic Range Rendering</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Compute Pipelines</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Showcase</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu/showcase/" aria-current="page" class="sidebar-link">Foreword</a></li><li><a href="/learn-wgpu/showcase/mipmaps/" aria-current="page" class="active sidebar-link">Mipmapping</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu/showcase/mipmaps/#what-are-mipmaps" class="sidebar-link">What are mipmaps?</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/showcase/mipmaps/#setting-up-mipmaps" class="sidebar-link">Setting up mipmaps</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/showcase/mipmaps/#rendering-to-a-mip-level" class="sidebar-link">Rendering to a mip level</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/showcase/mipmaps/#generating-mipmaps-with-a-compute-shader" class="sidebar-link">Generating mipmaps with a compute shader</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/showcase/mipmaps/#conclusion" class="sidebar-link">Conclusion</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu/showcase/mipmaps/#supporters" class="sidebar-link">Supporters</a></li></ul></li><li><a href="/learn-wgpu/showcase/stencil/" class="sidebar-link">Stencil Buffers</a></li><li><a href="/learn-wgpu/showcase/windowless/" class="sidebar-link">Wgpu without a window</a></li><li><a href="/learn-wgpu/showcase/gifs/" class="sidebar-link">Creating gifs</a></li><li><a href="/learn-wgpu/showcase/pong/" class="sidebar-link">Pong</a></li><li><a href="/learn-wgpu/showcase/alignment/" class="sidebar-link">Memory Layout in WGSL</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>News</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mipmapping"><a href="#mipmapping" class="header-anchor">#</a> Mipmapping</h1> <p>I games and other graphics applications it's often convenient to
use a single texture that gets tiled across the surface. If you
use a texture with some complexity, and your scene is large you'll
get a lot of noise in the distances.</p> <p><img src="/learn-wgpu/assets/img/ground-with-no-mips.10bff3c7.png" alt="ground with no mips"></p> <p>This looks really bad, but fortunately we can fix this with mipmaps.</p> <h2 id="what-are-mipmaps"><a href="#what-are-mipmaps" class="header-anchor">#</a> What are mipmaps?</h2> <p>Mipmaps are smaller versions of an image that are stored in the same
texture. Each mip is half the size of the one above it. Below you can
see mip level 0, or the texture at full size viewed in RenderDoc.</p> <p><img src="/learn-wgpu/assets/img/mip0.d6bdc77d.png" alt="mip0"></p> <p>This is the full 1024x1024 image. The next level is 1 and looks like this:</p> <p><img src="/learn-wgpu/assets/img/mip1.cc82b20e.png" alt="mip1"></p> <p>This is half the size of the original (512x512). Skipping the few here's
level 5 which is 32x32.</p> <p><img src="/learn-wgpu/assets/img/mip5.612e875c.png" alt="mip5"></p> <p>Level 9 is just 2x2</p> <p><img src="/learn-wgpu/assets/img/mip9.a3eeb7bd.png" alt="mip9"></p> <p>You may be thinking, well that's nice and all, but how does it make our
scene look less noisy? The trick is that when we sample a texture in
the fragment shader, if the texture has mipmaps enabled the GPU will
try to pick the best one based on how much space it thinks the texture
will take up on screen. Here's what our scene looks like with a texture
that has mip maps setup:</p> <p><img src="/learn-wgpu/assets/img/ground-with-mips.f967214a.png" alt="ground-with-mips.png"></p> <p>This looks a lot better as the horizon is no longer a noisy mess. Let's
dive into how we achieved this.</p> <h2 id="setting-up-mipmaps"><a href="#setting-up-mipmaps" class="header-anchor">#</a> Setting up mipmaps</h2> <p>I'll gloss over the code for rending the base scene as it's nothing
special. I'm just rendering a textured quad thats 2000x2000 units large.
The texture setup is more involved though. Let's dig into that.</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code><span class="token comment">// Load the texture with the [image] crate</span>
<span class="token keyword">let</span> diffuse_img <span class="token operator">=</span> image<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function-calls function">open</span><span class="token punctuation">(</span>res_dir<span class="token punctuation">.</span><span class="token function-calls function">join</span><span class="token punctuation">(</span>&quot;textures<span class="token operator">/</span>cobble<span class="token operator">-</span>diffuse<span class="token punctuation">.</span>png&quot;<span class="token punctuation">)</span><span class="token punctuation">)</span>?<span class="token punctuation">.</span><span class="token function-calls function">to_rgba8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Here we compute the number of mip levels using the smaller of width and height</span>
<span class="token keyword">let</span> mip_level_count <span class="token operator">=</span> diffuse_img<span class="token punctuation">.</span><span class="token function-calls function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>diffuse_img<span class="token punctuation">.</span><span class="token function-calls function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-calls function">ilog2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token int-literal number">1</span><span class="token punctuation">;</span>

<span class="token comment">// Now we create the texture</span>
<span class="token keyword">let</span> diffuse_blit_texture <span class="token operator">=</span> display<span class="token punctuation">.</span>device<span class="token punctuation">.</span><span class="token function-calls function">create_texture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TextureDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token function-calls function">Some</span><span class="token punctuation">(</span>&quot;textures<span class="token operator">/</span>cobble<span class="token operator">-</span>diffuse<span class="token punctuation">.</span>png&quot;<span class="token punctuation">)</span><span class="token punctuation">,</span>
    size<span class="token punctuation">:</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">Extent3d</span> <span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> diffuse_img<span class="token punctuation">.</span><span class="token function-calls function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> diffuse_img<span class="token punctuation">.</span><span class="token function-calls function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        depth_or_array_layers<span class="token punctuation">:</span> <span class="token int-literal number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mip_level_count<span class="token punctuation">,</span> <span class="token comment">// This is the important bit</span>
    sample_count<span class="token punctuation">:</span> <span class="token int-literal number">1</span><span class="token punctuation">,</span>
    dimension<span class="token punctuation">:</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TextureDimension</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">D2</span><span class="token punctuation">,</span>
    format<span class="token punctuation">:</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TextureFormat</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">Rgba8UnormSrgb</span><span class="token punctuation">,</span>
    usage<span class="token punctuation">:</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TextureUsages</span><span class="token punctuation">:</span><span class="token punctuation">:</span>TEXTURE_BINDING
        <span class="token operator">|</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TextureUsages</span><span class="token punctuation">:</span><span class="token punctuation">:</span>COPY_DST
        <span class="token operator">|</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TextureUsages</span><span class="token punctuation">:</span><span class="token punctuation">:</span>COPY_SRC<span class="token punctuation">,</span>
    view_formats<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Now we upload our image to our texture</span>
display<span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function-calls function">write_texture</span><span class="token punctuation">(</span>
    wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TexelCopyTextureInfo</span> <span class="token punctuation">{</span>
        texture<span class="token punctuation">:</span> <span class="token operator">&amp;</span>diffuse_blit_texture<span class="token punctuation">,</span>
        <span class="token comment">// We need to specify what mip level we are coppying to</span>
        mip_level<span class="token punctuation">:</span> <span class="token int-literal number">0</span><span class="token punctuation">,</span>
        origin<span class="token punctuation">:</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">Origin3d</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">ZERO</span><span class="token punctuation">,</span>
        aspect<span class="token punctuation">:</span> wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TextureAspect</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">All</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>diffuse_img<span class="token punctuation">,</span>
    wgpu<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token class-name">TexelCopyBufferLayout</span> <span class="token punctuation">{</span>
        offset<span class="token punctuation">:</span> <span class="token int-literal number">0</span><span class="token punctuation">,</span>
        bytes_per_row<span class="token punctuation">:</span> <span class="token function-calls function">Some</span><span class="token punctuation">(</span><span class="token int-literal number">4</span> <span class="token operator">*</span> diffuse_img<span class="token punctuation">.</span><span class="token function-calls function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rows_per_image<span class="token punctuation">:</span> <span class="token function-calls function">Some</span><span class="token punctuation">(</span>diffuse_img<span class="token punctuation">.</span><span class="token function-calls function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    diffuse_blit_texture<span class="token punctuation">.</span><span class="token function-calls function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>No if you were to sample this texture as is, you would see a lot
of black pixels far away, and the regular texture up close.</p> <p><img src="/learn-wgpu/assets/img/texture-with-ungenerated-mips.f1207b19.png" alt="texture with ungenerated mips"></p> <p>The reason for this is hinted when we used <code>write_texture()</code>. We
need to specify what mip level we were copying to. This means that
all of the other mip levels are black as that's what wgpu sets them
to when creating the texture. We need to fill that data in ourselves.</p> <p>We'll create a struct called <code>Mipmapper</code> that will generate our the
other mip levels for us.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">/// Pipeline for creating mipmaps</span>
<span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">crate</span><span class="token punctuation">)</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Mipmapper</span> <span class="token punctuation">{</span>
    blit_mipmap<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPipeline</span><span class="token punctuation">,</span>
    blit_sampler<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Sampler</span><span class="token punctuation">,</span>
    compute_mipmap<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ComputePipeline</span><span class="token punctuation">,</span>
    storage_texture_layout<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayout</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Mipmapper</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>device<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You'll see that we have two different pipelines here a <code>RenderPipeline</code>
and a <code>ComputePipeline</code>. There are a lot of ways that we could generate
our other mip levels, we'll show off two here: rendering, and using a
compute shader.</p> <h2 id="rendering-to-a-mip-level"><a href="#rendering-to-a-mip-level" class="header-anchor">#</a> Rendering to a mip level</h2> <p>When we create a <code>RenderPass</code> we pass in a <code>TextureView</code>. This view allows
us to pick what part of the texture a shader is allowed to access. The GPU
will render to whatever mip level is set by the <code>base_mip_level</code> when we
create the texture view. We can use this to draw directly to specific mips
which is just what we need to fill out our mipmaps.</p> <p>Basically we are going to create a pipeline that will get a texture view
starting at mip level 0, and render that with linear sampling to mip level 1.
We'll repeat this for 1 -&gt; 2, 2 -&gt; 3, etc. until we get to the last level,
in this case 10.</p> <p>First we have to create the pipeline.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">Mipmapper</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>device<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> blit_shader <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token macro property">include_wgsl!</span><span class="token punctuation">(</span><span class="token string">&quot;blit.wgsl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> blit_format <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8Unorm</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> blit_mipmap <span class="token operator">=</span> <span class="token class-name">RenderPipelineBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">vertex_shader</span><span class="token punctuation">(</span>blit_shader<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">fragment_shader</span><span class="token punctuation">(</span>blit_shader<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">cull_mode</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Face</span><span class="token punctuation">::</span><span class="token class-name">Back</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">color_solid</span><span class="token punctuation">(</span>blit_format<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> blit_sampler <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_sampler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">SamplerDescriptor</span> <span class="token punctuation">{</span>
            min_filter<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FilterMode</span><span class="token punctuation">::</span><span class="token class-name">Linear</span><span class="token punctuation">,</span>
            mag_filter<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FilterMode</span><span class="token punctuation">::</span><span class="token class-name">Linear</span><span class="token punctuation">,</span>
            <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We're using a custom <a href="https://github.com/sotrh/learn-wgpu/blob/master/code/showcase/framework/src/pipeline.rs" target="_blank" rel="noopener noreferrer">RenderPipelineBuilder<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
to make setting up the render pipeline easier. In this case this just
creates a render pipeline with a vertex and fragment shader defined in
<code>blit.wgsl</code> that expects to render to a <code>Rgba8Unorm</code> texture with back
face culling enabled.</p> <p>We also need a sampler with linear sampling enabled so each mipmap blends
seamlessly with the one above it.</p> <p>Next let's look at <code>blit.wgsl</code>:</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code><span class="token keyword">struct</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">position</span><span class="token punctuation">)</span></span> clip_position<span class="token punctuation">:</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> uv<span class="token punctuation">:</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> tex<span class="token punctuation">:</span> <span class="token builtin">texture_2d</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> tex_sampler<span class="token punctuation">:</span> <span class="token builtin">sampler</span><span class="token punctuation">;</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">vertex</span>
<span class="token keyword">fn</span> <span class="token functions function">vs_main</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">vertex_index</span><span class="token punctuation">)</span></span> in_vertex_index<span class="token punctuation">:</span> <span class="token builtin">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> out<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">;</span>
    <span class="token comment">// Create fullscreen triangle</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token builtin">f32</span><span class="token punctuation">(</span><span class="token punctuation">(</span>in_vertex_index <span class="token operator">&lt;&lt;</span> <span class="token int-literal number">1u</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token int-literal number">2u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token builtin">f32</span><span class="token punctuation">(</span>in_vertex_index <span class="token operator">&amp;</span> <span class="token int-literal number">2u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>clip_position <span class="token operator">=</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token decimal-float-literal number">2.0</span> <span class="token operator">-</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">,</span> y <span class="token operator">*</span> <span class="token decimal-float-literal number">2.0</span> <span class="token operator">-</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">0.0</span><span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    out<span class="token punctuation">.</span>uv <span class="token operator">=</span> <span class="token builtin">vec2</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token decimal-float-literal number">1.0</span> <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">fragment</span>
<span class="token keyword">fn</span> <span class="token functions function">fs_color</span><span class="token punctuation">(</span>in<span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token builtin">vec4</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> sample <span class="token operator">=</span> <span class="token builtin">textureSample</span><span class="token punctuation">(</span>tex<span class="token punctuation">,</span> tex_sampler<span class="token punctuation">,</span> in<span class="token punctuation">.</span>uv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sample<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This shader draws a triangle that is bigger than the viewport (in this
case the mip level we are rendering to). It then samples a texture
and outputs that sample directly.</p> <p>Next we will create a function to actually use all of this.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">Mipmapper</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">blit_mipmaps</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>
        device<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">,</span>
        queue<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Queue</span><span class="token punctuation">,</span>
        texture<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Texture</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// We would need to change the render pipeline to support different texture types</span>
        <span class="token keyword">match</span> texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8Unorm</span> <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8UnormSrgb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            _ <span class="token operator">=&gt;</span> <span class="token macro property">bail!</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported format {:?}&quot;</span><span class="token punctuation">,</span> texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Exit early if there is only one mip level.</span>
        <span class="token keyword">if</span> texture<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> <span class="token keyword">mut</span> encoder <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_command_encoder</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// We need to render to this texture, so if the supplied texture</span>
        <span class="token comment">// isn't setup for rendering, we need to create a temporary one.</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">mut</span> src_view<span class="token punctuation">,</span> maybe_temp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">if</span> texture
            <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">RENDER_ATTACHMENT</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">(</span>
                texture<span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDescriptor</span> <span class="token punctuation">{</span>
                    <span class="token comment">// sRGB and non sRGB textures can be interchanged, but</span>
                    <span class="token comment">// we specified RGBA8Unorm when we created the pipeline</span>
                    <span class="token comment">// so we need a view with the same format.</span>
                    format<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove_srgb_suffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    base_mip_level<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    <span class="token comment">// When rendering to a mip we need to ignore all other</span>
                    <span class="token comment">// mip levels.</span>
                    mip_level_count<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">None</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// Create a temporary texture that can be rendered to since the</span>
            <span class="token comment">// supplied texture can't be rendered to. It will be basically</span>
            <span class="token comment">// identical to the original apart from the usage field and removing</span>
            <span class="token comment">// sRGB from the format if it's present.</span>
            <span class="token keyword">let</span> temp <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_texture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureDescriptor</span> <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Mipmapper::compute_mipmaps::temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                size<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                mip_level_count<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                sample_count<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">sample_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                dimension<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">dimension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                format<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove_srgb_suffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">RENDER_ATTACHMENT</span>
                    <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">TEXTURE_BINDING</span>
                    <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_DST</span>
                    <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_SRC</span><span class="token punctuation">,</span>
                view_formats<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            encoder<span class="token punctuation">.</span><span class="token function">copy_texture_to_texture</span><span class="token punctuation">(</span>
                texture<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                temp<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                temp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">(</span>
                temp<span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDescriptor</span> <span class="token punctuation">{</span>
                    mip_level_count<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Some</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> mip <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span>texture<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> dst_view <span class="token operator">=</span> src_view
                <span class="token punctuation">.</span><span class="token function">texture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDescriptor</span> <span class="token punctuation">{</span>
                    format<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove_srgb_suffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token comment">// What mip we want to render to</span>
                    base_mip_level<span class="token punctuation">:</span> mip<span class="token punctuation">,</span>
                    <span class="token comment">// Like src_view we need to ignore other mips</span>
                    mip_level_count<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">let</span> texture_bind_group <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_bind_group</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupDescriptor</span> <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                layout<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>blit_mipmap<span class="token punctuation">.</span><span class="token function">get_bind_group_layout</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupEntry</span> <span class="token punctuation">{</span>
                        binding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                        resource<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingResource</span><span class="token punctuation">::</span><span class="token class-name">TextureView</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>src_view<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupEntry</span> <span class="token punctuation">{</span>
                        binding<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        resource<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingResource</span><span class="token punctuation">::</span><span class="token class-name">Sampler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>blit_sampler<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">let</span> <span class="token keyword">mut</span> pass <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">begin_render_pass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassDescriptor</span> <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                color_attachments<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassColorAttachment</span> <span class="token punctuation">{</span>
                    view<span class="token punctuation">:</span> <span class="token operator">&amp;</span>dst_view<span class="token punctuation">,</span>
                    depth_slice<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                    resolve_target<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                    ops<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Operations</span> <span class="token punctuation">{</span>
                        load<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">LoadOp</span><span class="token punctuation">::</span><span class="token class-name">Load</span><span class="token punctuation">,</span>
                        store<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">StoreOp</span><span class="token punctuation">::</span><span class="token class-name">Store</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                depth_stencil_attachment<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                timestamp_writes<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                occlusion_query_set<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                multiview_mask<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>blit_mipmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pass<span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pass<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Make sure that we use the mip we just generated for the</span>
            <span class="token comment">// next iteration.</span>
            src_view <span class="token operator">=</span> dst_view<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// If we created a temporary texture, now we need to copy it back</span>
        <span class="token comment">// into the original.</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">=</span> maybe_temp <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token keyword">mut</span> size <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> mip_level <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>temp<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                encoder<span class="token punctuation">.</span><span class="token function">copy_texture_to_texture</span><span class="token punctuation">(</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TexelCopyTextureInfo</span> <span class="token punctuation">{</span>
                        mip_level<span class="token punctuation">,</span>
                        <span class="token punctuation">..</span>temp<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TexelCopyTextureInfo</span> <span class="token punctuation">{</span>
                        mip_level<span class="token punctuation">,</span>
                        <span class="token punctuation">..</span>texture<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    size<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Each mipmap is half the size of the original,</span>
                <span class="token comment">// so we need to half the copy size as well.</span>
                size<span class="token punctuation">.</span>width <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                size<span class="token punctuation">.</span>height <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        queue<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">[</span>encoder<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>With all that we can create our <code>Mipmapper</code> and call <code>blit_mipmaps</code>
with our texture.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> mipmapper <span class="token operator">=</span> <span class="token class-name">Mipmapper</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>display<span class="token punctuation">.</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span>
mipmapper<span class="token punctuation">.</span><span class="token function">blit_mipmaps</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>display<span class="token punctuation">.</span>device<span class="token punctuation">,</span> <span class="token operator">&amp;</span>display<span class="token punctuation">.</span>queue<span class="token punctuation">,</span> <span class="token operator">&amp;</span>diffuse_blit_texture<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
</code></pre></div><p>With that our texture looks great even at far distances.
<img src="/learn-wgpu/assets/img/ground-with-mips.f967214a.png" alt="ground-with-mips.png"></p> <div class="note"><p>You may have noticed that when we created the render pipeline we used the
texture format <code>RgbaUnorm</code>, if we wanted to support a different format
we'd need to create a separate pipeline to render to that format. All of
the textures in this guide are either <code>RgbaUnorm</code> or <code>RgbaUnormSrgb</code>, so
I only added support for the one.</p> <p>It's important that you pick a texture format that you can render to, as
this method will not work otherwise. You can check out the
<a href="https://www.w3.org/TR/webgpu/#renderable" target="_blank" rel="noopener noreferrer">WebGPU specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
for how to tell if a format is renderable or not.</p></div> <h2 id="generating-mipmaps-with-a-compute-shader"><a href="#generating-mipmaps-with-a-compute-shader" class="header-anchor">#</a> Generating mipmaps with a compute shader</h2> <p>While drawing to mips directly using a render pipeline works just fine,
there are times where we want to store data in the mip chain of a texture
in a compute shader. It's going to be a little more work than the
the rendering example so lets get started with the shader.</p> <div class="language-wgsl extra-class"><pre class="language-wgsl"><code><span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> src<span class="token punctuation">:</span> <span class="token builtin">texture_storage_2d</span><span class="token punctuation">&lt;</span>rgba8unorm<span class="token punctuation">,</span> read<span class="token punctuation">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> dst<span class="token punctuation">:</span> <span class="token builtin">texture_storage_2d</span><span class="token punctuation">&lt;</span>rgba8unorm<span class="token punctuation">,</span> write<span class="token punctuation">&gt;</span><span class="token punctuation">;</span>

<span class="token punctuation">@</span><span class="token attributes attr-name">compute</span>
<span class="token punctuation">@</span><span class="token attributes attr-name">workgroup_size</span><span class="token punctuation">(</span><span class="token int-literal number">16</span><span class="token punctuation">,</span> <span class="token int-literal number">16</span><span class="token punctuation">,</span> <span class="token int-literal number">1</span><span class="token punctuation">)</span>
<span class="token keyword">fn</span> <span class="token functions function">compute_mipmap</span><span class="token punctuation">(</span>
    <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">global_invocation_id</span><span class="token punctuation">)</span></span> gid<span class="token punctuation">:</span> <span class="token builtin">vec3</span><span class="token punctuation">&lt;</span><span class="token builtin">u32</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dstPos <span class="token operator">=</span> gid<span class="token punctuation">.</span>xy<span class="token punctuation">;</span>
    <span class="token keyword">let</span> srcPos <span class="token operator">=</span> gid<span class="token punctuation">.</span>xy <span class="token operator">*</span> <span class="token int-literal number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> dim <span class="token operator">=</span> <span class="token builtin">textureDimensions</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>dstPos<span class="token punctuation">.</span>x <span class="token operator">&gt;=</span> dim<span class="token punctuation">.</span>x <span class="token operator">||</span> dstPos<span class="token punctuation">.</span>y <span class="token operator">&gt;=</span> dim<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> t00 <span class="token operator">=</span> <span class="token builtin">textureLoad</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> srcPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t01 <span class="token operator">=</span> <span class="token builtin">textureLoad</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> srcPos <span class="token operator">+</span> <span class="token builtin">vec2</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">,</span> <span class="token int-literal number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t10 <span class="token operator">=</span> <span class="token builtin">textureLoad</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> srcPos <span class="token operator">+</span> <span class="token builtin">vec2</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">,</span> <span class="token int-literal number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t11 <span class="token operator">=</span> <span class="token builtin">textureLoad</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> srcPos <span class="token operator">+</span> <span class="token builtin">vec2</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">,</span> <span class="token int-literal number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// A simple linear average of 4 adjacent pixels</span>
    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>t00 <span class="token operator">+</span> t01 <span class="token operator">+</span> t10 <span class="token operator">+</span> t11<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token decimal-float-literal number">0.25</span><span class="token punctuation">;</span>

    <span class="token builtin">textureStore</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> dstPos<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>So what this shader does is take in to texture views, <code>src</code> will be
a mip from the texture and <code>dst</code> will be the mip directly below that.
We will that grab 4 pixels from the <code>src</code> texture, compute there
average and store that into <code>dst</code> texture.</p> <div class="note"><p>Similar to the render pipeline, this compute pipeline only works
with <code>Rgba8Unorm</code> textures. Supporting other textures requires we
modify both the shader and the bind group setup (that we'll cover
next). We are also limited to textures that can be used as a
storage texture.</p></div> <p>With that done we can move on to setting up the compute pipeline.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">Mipmapper</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>device<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> storage_texture_layout <span class="token operator">=</span>
            device<span class="token punctuation">.</span><span class="token function">create_bind_group_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutDescriptor</span> <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Mipmapper::texture_layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutEntry</span> <span class="token punctuation">{</span>
                        binding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                        visibility<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderStages</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span>
                        ty<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingType</span><span class="token punctuation">::</span><span class="token class-name">StorageTexture</span> <span class="token punctuation">{</span>
                            access<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">StorageTextureAccess</span><span class="token punctuation">::</span><span class="token class-name">ReadOnly</span><span class="token punctuation">,</span>
                            format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8Unorm</span><span class="token punctuation">,</span>
                            view_dimension<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDimension</span><span class="token punctuation">::</span><span class="token constant">D2</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        count<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupLayoutEntry</span> <span class="token punctuation">{</span>
                        binding<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                        visibility<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderStages</span><span class="token punctuation">::</span><span class="token constant">COMPUTE</span><span class="token punctuation">,</span>
                        ty<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingType</span><span class="token punctuation">::</span><span class="token class-name">StorageTexture</span> <span class="token punctuation">{</span>
                            access<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">StorageTextureAccess</span><span class="token punctuation">::</span><span class="token class-name">WriteOnly</span><span class="token punctuation">,</span>
                            format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8Unorm</span><span class="token punctuation">,</span>
                            view_dimension<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDimension</span><span class="token punctuation">::</span><span class="token constant">D2</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        count<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> pipeline_layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_pipeline_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayoutDescriptor</span> <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
            bind_group_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>storage_texture_layout<span class="token punctuation">]</span><span class="token punctuation">,</span>
            immediate_size<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> compute_module <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token macro property">include_wgsl!</span><span class="token punctuation">(</span><span class="token string">&quot;mipmap.wgsl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> compute_mipmap <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_compute_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ComputePipelineDescriptor</span> <span class="token punctuation">{</span>
            label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Mipmapper&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            layout<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pipeline_layout<span class="token punctuation">)</span><span class="token punctuation">,</span>
            module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>compute_module<span class="token punctuation">,</span>
            entry_point<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;compute_mipmap&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            compilation_options<span class="token punctuation">:</span> <span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            cache<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>With that in place we can create a function to use the compute
pipeline.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span> <span class="token class-name">Mipmapper</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">crate</span><span class="token punctuation">)</span> <span class="token keyword">fn</span> <span class="token function-definition function">compute_mipmaps</span><span class="token punctuation">(</span>
        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>
        device<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Device</span><span class="token punctuation">,</span>
        queue<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Queue</span><span class="token punctuation">,</span>
        texture<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Texture</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// We would need to change the shader to support different texture types</span>
        <span class="token keyword">match</span> texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8Unorm</span> <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8UnormSrgb</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
            _ <span class="token operator">=&gt;</span> <span class="token macro property">bail!</span><span class="token punctuation">(</span><span class="token string">&quot;Unsupported format {:?}&quot;</span><span class="token punctuation">,</span> texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> texture<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> <span class="token keyword">mut</span> encoder <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_command_encoder</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Create temp texture if supplied texture isn't setup for use</span>
        <span class="token comment">// as a storage texture</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">mut</span> src_view<span class="token punctuation">,</span> maybe_temp<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">if</span> texture
            <span class="token punctuation">.</span><span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">STORAGE_BINDING</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">(</span>
                texture<span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDescriptor</span> <span class="token punctuation">{</span>
                    mip_level_count<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">None</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> temp <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_texture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureDescriptor</span> <span class="token punctuation">{</span>
                label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Mipmapper::compute_mipmaps::temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                size<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                mip_level_count<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                sample_count<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">sample_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                dimension<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">dimension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                format<span class="token punctuation">:</span> texture<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove_srgb_suffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">STORAGE_BINDING</span>
                    <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_DST</span>
                    <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_SRC</span><span class="token punctuation">,</span>
                view_formats<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            encoder<span class="token punctuation">.</span><span class="token function">copy_texture_to_texture</span><span class="token punctuation">(</span>
                texture<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                temp<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                temp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">(</span>
                temp<span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDescriptor</span> <span class="token punctuation">{</span>
                    mip_level_count<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Some</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> dispatch_x <span class="token operator">=</span> texture<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> dispatch_y <span class="token operator">=</span> texture<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">div_ceil</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token keyword">mut</span> pass <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">begin_compute_pass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ComputePassDescriptor</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>compute_mipmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> mip <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span>texture<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> dst_view <span class="token operator">=</span> src_view
                    <span class="token punctuation">.</span><span class="token function">texture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureViewDescriptor</span> <span class="token punctuation">{</span>
                        base_mip_level<span class="token punctuation">:</span> mip<span class="token punctuation">,</span>
                        mip_level_count<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> texture_bind_group <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_bind_group</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupDescriptor</span> <span class="token punctuation">{</span>
                    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                    layout<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>storage_texture_layout<span class="token punctuation">,</span>
                    entries<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
                        <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupEntry</span> <span class="token punctuation">{</span>
                            binding<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                            resource<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingResource</span><span class="token punctuation">::</span><span class="token class-name">TextureView</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>src_view<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindGroupEntry</span> <span class="token punctuation">{</span>
                            binding<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                            resource<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BindingResource</span><span class="token punctuation">::</span><span class="token class-name">TextureView</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dst_view<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                pass<span class="token punctuation">.</span><span class="token function">set_bind_group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>texture_bind_group<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                pass<span class="token punctuation">.</span><span class="token function">dispatch_workgroups</span><span class="token punctuation">(</span>dispatch_x<span class="token punctuation">,</span> dispatch_y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                src_view <span class="token operator">=</span> dst_view<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">=</span> maybe_temp <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token keyword">mut</span> size <span class="token operator">=</span> temp<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> mip_level <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>temp<span class="token punctuation">.</span><span class="token function">mip_level_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                encoder<span class="token punctuation">.</span><span class="token function">copy_texture_to_texture</span><span class="token punctuation">(</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TexelCopyTextureInfo</span> <span class="token punctuation">{</span>
                        mip_level<span class="token punctuation">,</span>
                        <span class="token punctuation">..</span>temp<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TexelCopyTextureInfo</span> <span class="token punctuation">{</span>
                        mip_level<span class="token punctuation">,</span>
                        <span class="token punctuation">..</span>texture<span class="token punctuation">.</span><span class="token function">as_image_copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    size<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Each mipmap is half the size of the original</span>
                size<span class="token punctuation">.</span>width <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                size<span class="token punctuation">.</span>height <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        queue<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">[</span>encoder<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>And that's it. With that we can use mipmaps with our textures!</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>We've only scratched the surface with mip maps. We will cover other
ways to use them later. With that being said you can check out
the code at the link below!</p> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/showcase/mipmaps/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <h2 id="supporters"><a href="#supporters" class="header-anchor">#</a> Supporters</h2> <p>Thanks to these supporters from <a href="https://patreon.com/sotrh" target="_blank" rel="noopener noreferrer">patreon<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://ko-fi.com/sotrh" target="_blank" rel="noopener noreferrer">ko-fi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>!</p> <ul><li>David Laban</li> <li>Bernard Llanos</li> <li>Ian Gowen</li> <li>Aron Granberg</li> <li> </li> <li>Julius Liu</li> <li>Lennart</li> <li>Jani Turkia</li> <li>Feng Liang</li> <li>Lions Heart</li> <li>Paul E Hansen</li> <li>Gunstein Vatnar</li> <li>Nico Arbogast</li> <li>Dude</li> <li>Youngsuk Kim</li> <li>Alexander Kabirov</li> <li>Danny McGee</li> <li>charlesk</li> <li>yutani</li> <li>Filip</li> <li>Eliot Bolduc</li> <li>Ben Anderson</li> <li>Thunk</li> <li>IC</li> <li>Craft Links</li> <li>Zeh Fernando</li> <li>Ken</li> <li>Ryan</li> <li>Felix</li> <li>Tema</li> <li> </li> <li>Andrea Postal</li> <li>Davide Prati</li> <li>dadofboi</li> <li></li> <li>Andrea Postal</li> <li>Davide Prati</li> <li>dadofboi</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/10/2026, 10:08:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        
        <a href="/learn-wgpu/showcase/" class="prev router-link-active">
          Foreword
        </a></span> <span class="next"><a href="/learn-wgpu/showcase/stencil/">
          Stencil Buffers
        </a>
        
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu/assets/js/app.9a4a1a92.js" defer></script><script src="/learn-wgpu/assets/js/3.09b12233.js" defer></script><script src="/learn-wgpu/assets/js/2.b4dddcef.js" defer></script><script src="/learn-wgpu/assets/js/15.51116715.js" defer></script><script src="/learn-wgpu/assets/js/39.f2a3e671.js" defer></script>
  </body>
</html>
